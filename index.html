<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal & Contingency Planner (Portable)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic appeal and readability */
        :root {
            --primary-color: #6366f1; /* Indigo 500 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .main-goal-header {
            border-bottom: 4px solid var(--primary-color);
        }
        .input-style {
            border: 1px solid #e5e7eb;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            transition: border-color 0.2s;
        }
        .input-style:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }
        .btn-primary:hover {
            background-color: #4f46e5; /* Indigo 600 */
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        .mini-goal-section {
            border-left: 4px solid #a5b4fc; /* Indigo 300 for children */
        }
        .if-then-section {
            border-left: 2px dashed #9ca3af; /* Gray for grandchildren */
        }
        .if-then-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .nav-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .nav-btn.active {
            background-color: white;
            color: var(--primary-color);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .nav-btn:not(.active) {
            background-color: #eef2ff; /* Indigo 50 */
            color: #4f46e5; /* Indigo 600 */
        }
        .nav-btn:not(.active):hover {
            background-color: #e0e7ff; /* Indigo 100 */
        }

        /* Report View specific styles */
        .report-section {
            padding: 1.5rem;
            border-radius: 0.75rem;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
        }
        .report-list-item {
            border-left: 3px solid #a5b4fc;
            padding-left: 1rem;
            margin-top: 0.5rem;
        }
        .report-if-then {
            background-color: #f7f9fd;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border: 1px dashed #e0e7ff;
        }
    </style>
    <!-- Local Storage Implementation for Portability -->
    <script type="module">
        let goalData = null;
        const STORAGE_KEY = 'goalContingencyPlannerData';
        let currentView = 'planner'; // State to manage current view: 'planner' or 'report'

        const loadGoalData = () => {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                if (storedData) {
                    goalData = JSON.parse(storedData);
                    console.log("Goal data loaded from localStorage.");
                } else {
                    console.log("No goal data found. Initializing empty structure.");
                    goalData = {
                        mainGoal: '',
                        dueDate: '',
                        outcome: '',
                        miniGoals: []
                    };
                }
            } catch (error) {
                console.error("Error loading data from localStorage:", error);
                // Fallback to empty structure on load error
                goalData = { mainGoal: '', dueDate: '', outcome: '', miniGoals: [] };
            }
            renderViewContent();
        };

        const saveGoalData = () => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(goalData));
                console.log("Goal data saved successfully to localStorage.");
            } catch (e) {
                console.error("Error saving document to localStorage: ", e);
            }
            // Always re-render to reflect changes and update the displayed view/report
            renderViewContent();
        };

        // --- View Switching and Rendering ---
        window.switchView = (view) => {
            currentView = view;
            renderViewContent();
        }

        const renderViewContent = () => {
            const container = document.getElementById('planner-container');
            const navPlannerBtn = document.getElementById('nav-planner');
            const navReportBtn = document.getElementById('nav-report');

            if (!container || !goalData || !navPlannerBtn || !navReportBtn) return;
            
            // Update navigation button styles
            navPlannerBtn.classList.toggle('active', currentView === 'planner');
            navReportBtn.classList.toggle('active', currentView === 'report');

            container.innerHTML = '';
            
            if (currentView === 'planner') {
                renderPlannerView(container);
            } else if (currentView === 'report') {
                renderReportView(container);
            }
        };

        const renderPlannerView = (container) => {
            // --- Main Goal Section (Edit View) ---
            const mainGoalHtml = `
                <div class="card p-6 mb-8 main-goal-header">
                    <h2 class="text-3xl font-extrabold text-gray-900 mb-4">
                        <span class="text-indigo-500">I Will:</span>
                        <textarea id="mainGoalInput" class="input-style h-12 text-2xl font-bold" placeholder="Define your main goal (e.g., Launch my side business)" oninput="updateMainGoal('mainGoal', this.value)">${goalData.mainGoal || ''}</textarea>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Overall Outcome (What Success Looks Like)</label>
                            <textarea id="outcomeInput" class="input-style h-16" placeholder="Measurable result (e.g., Generate $5,000 in revenue)" oninput="updateMainGoal('outcome', this.value)">${goalData.outcome || ''}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Target Due Date</label>
                            <input type="date" id="dueDateInput" class="input-style" value="${goalData.dueDate || ''}" onchange="updateMainGoal('dueDate', this.value)">
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', mainGoalHtml);

            // --- Mini Goals Section (Edit View) ---
            const miniGoalsList = document.createElement('div');
            miniGoalsList.id = 'mini-goals-list';
            miniGoalsList.className = 'space-y-6';
            container.appendChild(miniGoalsList);

            (goalData.miniGoals || []).forEach((miniGoal, mgIndex) => {
                const miniGoalCard = document.createElement('div');
                miniGoalCard.className = 'card p-4 ml-4 mini-goal-section';

                // Mini Goal Details
                miniGoalCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-semibold text-indigo-700 w-full pr-4">
                            Mini-Goal #${mgIndex + 1}:
                            <textarea id="mgGoal-${mgIndex}" class="input-style h-10 font-semibold mt-1" placeholder="Define this milestone (e.g., Complete product prototype)" oninput="updateMiniGoal(${mgIndex}, 'goal', this.value)">${miniGoal.goal || ''}</textarea>
                        </h3>
                        <button onclick="deleteMiniGoal(${mgIndex})" class="text-red-500 hover:text-red-700 text-sm font-medium mt-2 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 7a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 00-1 1v4a1 1 0 102 0v-4a1 1 0 00-1-1zm4 1a1 1 0 11-2 0v4a1 1 0 112 0v-4z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600">Mini-Goal Outcome</label>
                            <textarea class="input-style h-12" placeholder="Specific success criteria" oninput="updateMiniGoal(${mgIndex}, 'outcome', this.value)">${miniGoal.outcome || ''}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600">Mini-Goal Due Date</label>
                            <input type="date" class="input-style" value="${miniGoal.dueDate || ''}" onchange="updateMiniGoal(${mgIndex}, 'dueDate', this.value)">
                        </div>
                    </div>

                    <!-- If-Then Obstacles Section -->
                    <div class="space-y-3 ml-4">
                        <h4 class="text-lg font-medium text-gray-700 border-b pb-2">Contingency Plan (If-Then Strategy)</h4>
                        ${(miniGoal.obstacles || []).map((obs, obsIndex) => `
                            <div class="card p-3 if-then-section bg-gray-50 flex items-start space-x-3">
                                <div class="flex-grow">
                                    <div class="mb-2">
                                        <span class="if-then-badge bg-red-100 text-red-700">IF: Obstacle</span>
                                        <textarea class="input-style h-10 mt-1" placeholder="Potential Obstacle (e.g., If I feel discouraged...)" oninput="updateIfThen(${mgIndex}, ${obsIndex}, 'if', this.value)">${obs.if || ''}</textarea>
                                    </div>
                                    <div>
                                        <span class="if-then-badge bg-green-100 text-green-700">THEN: Action Strategy</span>
                                        <textarea class="input-style h-10 mt-1" placeholder="Proactive Action (e.g., ...then I will call my mentor)" oninput="updateIfThen(${mgIndex}, ${obsIndex}, 'then', this.value)">${obs.then || ''}</textarea>
                                    </div>
                                </div>
                                <button onclick="deleteIfThen(${mgIndex}, ${obsIndex})" class="text-red-400 hover:text-red-600 text-sm mt-1 flex-shrink-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        `).join('')}
                        <button onclick="addIfThen(${mgIndex})" class="btn-primary bg-indigo-200 text-indigo-800 text-sm mt-3 hover:bg-indigo-300 transition-colors">
                            + Add IF-THEN Contingency
                        </button>
                    </div>
                `;
                miniGoalsList.appendChild(miniGoalCard);
            });

            // Add Mini Goal Button
            const addGoalButton = document.createElement('div');
            addGoalButton.className = 'mt-6 text-center';
            addGoalButton.innerHTML = `
                <button onclick="addMiniGoal()" class="btn-primary text-lg">
                    + Add New Mini Goal/Milestone
                </button>
            `;
            container.appendChild(addGoalButton);
        };

        const renderReportView = (container) => {
            const mainGoal = goalData.mainGoal || 'No Main Goal Defined';
            const outcome = goalData.outcome || 'N/A';
            const dueDate = goalData.dueDate || 'N/A';
            const miniGoals = goalData.miniGoals || [];

            let reportHtml = `
                <div class="report-section bg-indigo-50 border-indigo-200">
                    <h2 class="text-3xl font-extrabold text-indigo-800 mb-4">Master Plan: ${mainGoal}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                        <div>
                            <strong class="text-sm font-semibold block text-indigo-600">OVERALL OUTCOME:</strong>
                            <p class="text-lg">${outcome}</p>
                        </div>
                        <div>
                            <strong class="text-sm font-semibold block text-indigo-600">TARGET DATE:</strong>
                            <p class="text-lg">${dueDate}</p>
                        </div>
                    </div>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 mb-4 mt-8">Execution Roadmap (${miniGoals.length} Milestones)</h3>
            `;
            
            if (miniGoals.length === 0) {
                reportHtml += `<p class="text-center text-gray-500 py-10">No Mini Goals have been added yet. Switch to the Planner tab to start!</p>`;
            } else {
                reportHtml += miniGoals.map((mg, mgIndex) => `
                    <div class="report-section">
                        <h4 class="text-xl font-bold text-indigo-700 mb-3">Milestone ${mgIndex + 1}: ${mg.goal || 'Untitled Mini Goal'}</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4 text-sm text-gray-700">
                            <div>
                                <strong class="block text-gray-500">Milestone Outcome:</strong>
                                ${mg.outcome || 'N/A'}
                            </div>
                            <div>
                                <strong class="block text-gray-500">Due Date:</strong>
                                ${mg.dueDate || 'N/A'}
                            </div>
                        </div>

                        <h5 class="text-lg font-semibold text-gray-700 mt-4 mb-2 border-t pt-3">Contingency Plan (If-Then Strategy)</h5>
                        <div class="space-y-2">
                            ${(mg.obstacles || []).length > 0 ? mg.obstacles.map((obs, obsIndex) => `
                                <div class="report-if-then">
                                    <p class="text-sm">
                                        <strong class="text-red-600">IF</strong>: ${obs.if || 'No obstacle defined'}
                                    </p>
                                    <p class="text-sm mt-1">
                                        <strong class="text-green-600">THEN</strong>: ${obs.then || 'No action defined'}
                                    </p>
                                </div>
                            `).join('') : '<p class="text-sm text-gray-500 italic">No IF-THEN contingencies defined for this milestone.</p>'}
                        </div>
                    </div>
                `).join('');
            }

            container.innerHTML = reportHtml;
        };
        
        // --- Data Manipulation Functions ---

        window.updateMainGoal = (key, value) => {
            goalData[key] = value;
            saveGoalData();
        };

        window.addMiniGoal = () => {
            if (!goalData.miniGoals) goalData.miniGoals = [];
            goalData.miniGoals.push({
                goal: '',
                dueDate: '',
                outcome: '',
                obstacles: []
            });
            saveGoalData();
        };

        window.deleteMiniGoal = (mgIndex) => {
            if (window.confirm("Are you sure you want to delete this Mini-Goal and all its contingency plans?")) {
                goalData.miniGoals.splice(mgIndex, 1);
                saveGoalData();
            }
        };

        window.updateMiniGoal = (mgIndex, key, value) => {
            if (goalData.miniGoals && goalData.miniGoals[mgIndex]) {
                goalData.miniGoals[mgIndex][key] = value;
                saveGoalData();
            }
        };

        window.addIfThen = (mgIndex) => {
            if (goalData.miniGoals && goalData.miniGoals[mgIndex]) {
                if (!goalData.miniGoals[mgIndex].obstacles) goalData.miniGoals[mgIndex].obstacles = [];
                goalData.miniGoals[mgIndex].obstacles.push({ if: '', then: '' });
                saveGoalData();
            }
        };

        window.deleteIfThen = (mgIndex, obsIndex) => {
            if (goalData.miniGoals && goalData.miniGoals[mgIndex] && goalData.miniGoals[mgIndex].obstacles) {
                goalData.miniGoals[mgIndex].obstacles.splice(obsIndex, 1);
                saveGoalData();
            }
        };

        window.updateIfThen = (mgIndex, obsIndex, key, value) => {
            if (goalData.miniGoals && goalData.miniGoals[mgIndex] && goalData.miniGoals[mgIndex].obstacles && goalData.miniGoals[mgIndex].obstacles[obsIndex]) {
                goalData.miniGoals[mgIndex].obstacles[obsIndex][key] = value;
                saveGoalData();
            }
        };

        // Initialize on load
        window.onload = loadGoalData;
    </script>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-3 text-center">
            <span class="text-indigo-600">G</span>oal & <span class="text-indigo-600">C</span>ontingency Planner
        </h1>

        <!-- Navigation Bar -->
        <nav class="flex justify-center mb-6 border-b border-gray-300">
            <button id="nav-planner" class="nav-btn" onclick="switchView('planner')">
                <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zM5 8a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h5a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                    Goal Planner (Edit)
                </span>
            </button>
            <button id="nav-report" class="nav-btn" onclick="switchView('report')">
                 <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM6 11a1 1 0 000 2h4a1 1 0 000-2H6z" />
                        <path fill-rule="evenodd" d="M17 4a2 2 0 012 2v10a2 2 0 01-2 2H3a2 2 0 01-2-2V6a2 2 0 012-2h14zm-5 12V5H5v11h10z" clip-rule="evenodd" />
                    </svg>
                    Tracking Report
                </span>
            </button>
        </nav>

        <!-- Planner Container (View Specific Content) -->
        <div id="planner-container">
            <!-- Content will be rendered here by JavaScript -->
            <div class="text-center p-10 text-gray-500">Loading your plan...</div>
        </div>

        <footer class="mt-12 text-center text-sm text-gray-500 border-t pt-4">
            Plan your success with Milestones and If-Then Contingencies.
        </footer>
    </div>
</body>
</html>
